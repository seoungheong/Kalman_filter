# 칼만필터 예시

#### 위치로 속도 추정하기

> 직선 선로에서 열차가 80m/s의 속도를 유지하는지 확인하는 것이다. 위치와 속조 정보는 0.1초 간격으로 측정해서 저장 하도록 되어 있다.
> 위치 정보만 빼고 속도 데이터가 없어졌을때

#### 칼만 필터의 필요성

> 측정 잡음 제거가 아니라 위치정보만 가지고 측정하지도 않은 속도를 알아내야 한다. 이는 저주파 통과 필터로 해결할 수 없는 문제다.
> 이러한 문제는 다양하다. 예를 들어 고도만 측정했는데 상승률을 계산해야 한다거나 각도만 가지고 회전 속도를 알아내야 하는 상황 등...

> 속도 = 이동거리/시간 이다. 따라서 짧은 시간동안 이동 거리를 그 시간으로 나누면 그 구간 속도도 구할 수 있다. 하지만 실제로 이는 차이가 많이 난다. 잡음 때문에 측정 거리는 엉망이고 분모인 시간은 아주 작아서, 나누면 값이 크게 튀기 때문이다.
> 이럴때 칼만 필터를 사용한다.

#### 시스템 모델

 x = { 위치, 속도 }^T
 
 ![image](https://user-images.githubusercontent.com/65435447/165744681-9aa8ff4d-f3e4-41cf-82d1-a03dc7f3a8cb.png)

t는 위치를 측정하는 시간 간격

![image](https://user-images.githubusercontent.com/65435447/165744811-00d1b7aa-4225-4804-beec-161d00a1b20d.png)

위 식을 정리하면 아래와 같은 식이 나온다.

![image](https://user-images.githubusercontent.com/65435447/165744868-b966b34c-b5ee-48b1-824c-57f6524554c3.png)

> 현재 위치 = 직선 위치 + 이동 거리
> 현재 속도 = 속도 + 시스템 잡음(w)
>
>이라는 식이 된다.

![image](https://user-images.githubusercontent.com/65435447/165745162-eca29059-4266-4f71-ab2f-a1e0f6f20621.png)

> 행렬 A와 H는 임의로 선정한 것이 아니라, 시스템의 물리적인 관계를 모델링한 결과물이였다. 즉 시스템 모델은 속도와 거리 사이의 물리적 관계, 속도에 영향을 주는 오차 요인 등을 수학식으로 표현한 것.

![image](https://user-images.githubusercontent.com/65435447/165745447-291ada66-adb3-4601-956a-517893ce70a1.png)

> 마지막으로 잡음의 공분산 행렬(Q, R)만 결정하면 시스템 모델의 유도는 끝. 
> * 측정 잡음 (v_k)의 오차 특성은 센서 제작사에서 제공하는 경우가 많다. 그렇지 않다면 실험과 경험을 통해 결정해야함. 시스템 잡음(w_k)의 모델링은 더 어려운데 시스템에 대한 지식과 경험에 의존할 수 밖에 없다. 만약 공분산 행렬(Q, R)을 논리적으로 구하기 어렵다면 두 행렬을 칼만 필터의 설계 인자로 보고 시행착오를 거처 선정하는 것도 한 방법이다.

어떤 방식으로 위치를 추정하는가?
> 시스템의 수학적 모델을 알고 있다고 가정합니다. 즉 시스템이 어떤 법칙에 따라 측정값을 출력하는지 정확히 알고 있다는 전제를 깔고 있습니다. 측정하지도 않은 물리량을 정확히 추정해내는 비밀은 여기에 잇습니다. 상태 변수 사이의 연관 관계를 나타내는 시스템 모델을 통해 측정하지 않은 상태 변수를 간접적으로 추정해내는 것입니다.

























